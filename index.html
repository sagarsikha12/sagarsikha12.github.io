<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ANC Visit Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="container">
    <h1>ANC Nepal</h1>

    <div class="tabs">
      <button class="tab-button active" onclick="openTab('tab-ad')">AD Input</button>
      <button class="tab-button" onclick="openTab('tab-bs')">BS Input</button>
    </div>

    <div id="tab-ad" class="tab-content active">
      <h3>Enter LMP in AD</h3>
      <input type="date" id="lmp-date-ad">
      <button onclick="convertToBS()">Convert to BS</button>
      <div id="lmp-bs-result"></div>
    </div>

    <div id="tab-bs" class="tab-content">
      <h3>Enter LMP in BS</h3>
      <input type="number" id="bs-year" placeholder="YYYY">
      <input type="number" id="bs-month" placeholder="MM">
      <input type="number" id="bs-day" placeholder="DD">
      <button onclick="convertToAD()">Convert to AD</button>
      <div id="lmp-ad-result"></div>
    </div>

    <hr>
    <button onclick="calculateANC()">Calculate ANC Visits</button>
    <div id="visit-schedule"></div>
    <div id="remaining-time"></div>

    <h4>Gestational Age and Remaining Time</h4>
    <input type="date" id="custom-date" onchange="calculateCustomGestationalAge()">
    <button onclick="setToToday()">Today</button>
    <div id="custom-gestational-info"></div>
  </div>

  <footer>
    <p>Created ❤️ by <strong>Bnd Yadav</strong> Health Assistant</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/nepali-date-converter/dist/nepali-date-converter.umd.js"></script>
  <script>
     // Function to set the custom date to today's date
     function setToToday() {
      todayDate = new Date();
      document.getElementById('custom-date').value = todayDate.toISOString().split('T')[0];
      calculateCustomGestationalAge();
    }
   

    // Function to switch between tabs
    function openTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`button[onclick="openTab('${tabId}')"]`).classList.add('active');
    }

     // Function to convert AD to BS
     function convertToBS() {
      const adDateInput = document.getElementById('lmp-date-ad').value;
      if (!adDateInput) {
        alert('Please enter a valid AD date.');
        return;
      }
      const adDate = new Date(adDateInput);
      const bsDate = new NepaliDate(adDate).format('YYYY-MM-DD');
      document.getElementById('lmp-bs-result').innerText = `Nepali LMP (BS): ${bsDate}`;
    }
    
    // Function to convert BS to AD
    function convertToAD() {
      const bsYear = document.getElementById('bs-year').value;
      const bsMonth = document.getElementById('bs-month').value;
      const bsDay = document.getElementById('bs-day').value;
      if (!bsYear || !bsMonth || !bsDay) {
        alert('Please enter a valid BS date.');
        return;
      }
      const bsDate = new NepaliDate(Number(bsYear), Number(bsMonth) - 1, Number(bsDay));
      const adDate = bsDate.toJsDate().toISOString().split('T')[0];
      document.getElementById('lmp-ad-result').innerText = `Gregorian LMP (AD): ${adDate}`;
    }

    function calculateANC() {
      const adDateInput = document.getElementById('lmp-date-ad').value;
      if (!adDateInput) {
        alert('Please enter a valid LMP date in AD format.');
        return;
      }
      const lmpDate = new Date(adDateInput);
      const todayDate = new Date();
      const weeksCompleted = Math.floor((todayDate - lmpDate) / (7 * 24 * 60 * 60 * 1000));
      const daysCompleted = Math.floor((todayDate - lmpDate) / (24 * 60 * 60 * 1000)) % 7;
      const edd = new Date(lmpDate);
      edd.setDate(lmpDate.getDate() + 280);
      
      const visits = [12, 16, 20, 24, 28, 32, 34, 36, 38, 40];
      let visitRows = '';
      visits.forEach((week, index) => {
        const visitDate = new Date(lmpDate);
        visitDate.setDate(lmpDate.getDate() + week * 7);
        visitRows += `
          <tr>
            <td>${index + 1}</td>
            <td>${week}</td>
            <td>${visitDate.toISOString().split('T')[0]}</td>
            <td>${new NepaliDate(visitDate).format('YYYY-MM-DD')}</td>
          </tr>
        `;
      });
      
      document.getElementById('visit-schedule').innerHTML = `
        <p><strong>Completed:</strong> ${weeksCompleted} weeks and ${daysCompleted} days</p>
        <p><strong>Estimated Date of Delivery:</strong> ${edd.toISOString().split('T')[0]} / ${new NepaliDate(edd).format('YYYY-MM-DD')}</p>
        <table style="font-size: smaller;">
          <thead>
            <tr>
              <th>#</th>
              <th>Weeks</th>
              <th>Date</th>
              <th>Date (BS)</th>
            </tr>
          </thead>
          <tbody>
            ${visitRows}
          </tbody>
        </table>
      `;
    }

    function calculateCustomGestationalAge() {
      const customDateInput = document.getElementById('custom-date').value;
      if (!customDateInput) {
        return;
      }
      const lmpDate = new Date(document.getElementById('lmp-date-ad').value);
      const customDate = new Date(customDateInput);
      const weeksCompleted = Math.floor((customDate - lmpDate) / (7 * 24 * 60 * 60 * 1000));
      const daysCompleted = Math.floor((customDate - lmpDate) / (24 * 60 * 60 * 1000)) % 7;
      const remainingDays = 280 - Math.floor((customDate - lmpDate) / (24 * 60 * 60 * 1000));

      document.getElementById('custom-gestational-info').innerHTML = `
        <p><strong>Gestational Age on Selected Date:</strong> ${weeksCompleted} weeks and ${daysCompleted} days</p>
        <p><strong>Remaining Time until EDD:</strong> ${remainingDays} days</p>
      `;
    }
  </script>
</body>

</html>
