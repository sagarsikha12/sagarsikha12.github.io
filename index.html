<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ANC Visit Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <h1>ANC Nepal</h1>

    <div class="tabs">
      <button class="tab-button active" onclick="openTab('tab-ad')">AD Input</button>
      <button class="tab-button" onclick="openTab('tab-bs')">BS Input</button>
    </div>

    <div id="tab-ad" class="tab-content active">
      <h3>Enter LMP in AD</h3>
      <input type="date" id="lmp-date-ad">
      <button onclick="convertToBS()">Convert to BS</button>
      <div id="lmp-bs-result"></div>
    </div>

    <div id="tab-bs" class="tab-content">
      <h3>Enter LMP in BS</h3>
      <input type="number" id="bs-year" placeholder="YYYY">
      <input type="number" id="bs-month" placeholder="MM">
      <input type="number" id="bs-day" placeholder="DD">
      <button onclick="convertToAD()">Convert to AD</button>
      <div id="lmp-ad-result"></div>
    </div>

    <hr>
    <h3>Calculate ANC Visits</h3>
    <button onclick="calculateANC()">Calculate ANC Visits</button>
    <div id="visit-schedule"></div>
    <div id="gestational-info"></div>
    <div id="remaining-time"></div>

  
    <h4>Check Custom Gestational Age and Remaining Time</h4>
    <input type="date" id="custom-date" onchange="calculateCustomGestationalAge()">
    <button onclick="setToToday()">Today</button>

    <div id="custom-gestational-info"></div>
    <div id="custom-remaining-time"></div>

  </div>

  <footer>
    <p>Created ❤️ by <strong>Bnd Yadav</strong> Health Assistant</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/nepali-date-converter/dist/nepali-date-converter.umd.js"></script>
  <script>
    let todayDate = new Date(); // Default to today's date

    // Function to switch between tabs
    function openTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`button[onclick="openTab('${tabId}')"]`).classList.add('active');
    }

    // Function to convert AD to BS
    function convertToBS() {
      const adDateInput = document.getElementById('lmp-date-ad').value;
      if (!adDateInput) {
        alert('Please enter a valid AD date.');
        return;
      }
      const adDate = new Date(adDateInput);
      const bsDate = new NepaliDate(adDate).format('YYYY-MM-DD');
      document.getElementById('lmp-bs-result').innerText = `Nepali LMP (BS): ${bsDate}`;
    }

    // Function to convert BS to AD
    function convertToAD() {
      const bsYear = document.getElementById('bs-year').value;
      const bsMonth = document.getElementById('bs-month').value;
      const bsDay = document.getElementById('bs-day').value;
      if (!bsYear || !bsMonth || !bsDay) {
        alert('Please enter a valid BS date.');
        return;
      }
      const bsDate = new NepaliDate(Number(bsYear), Number(bsMonth) - 1, Number(bsDay));
      const adDate = bsDate.toJsDate().toISOString().split('T')[0];
      document.getElementById('lmp-ad-result').innerText = `Gregorian LMP (AD): ${adDate}`;
    }

    // Function to calculate ANC visits
    function calculateANC() {
      const adDateInput = document.getElementById('lmp-date-ad').value;
      if (!adDateInput) {
        alert('Please enter a valid LMP date in AD format.');
        return;
      }
      const lmpDate = new Date(adDateInput);

      const weeksCompleted = Math.floor((todayDate - lmpDate) / (7 * 24 * 60 * 60 * 1000));
      const monthsCompleted = Math.floor(weeksCompleted / 4.33); // Approximate weeks in a month
      const daysCompleted = Math.floor((todayDate - lmpDate) / (24 * 60 * 60 * 1000));

      const edd = new Date(lmpDate);
      edd.setDate(lmpDate.getDate() + 280);  // 280 days for pregnancy

      // Calculate Remaining Time
      const remainingTime = new Date(edd - todayDate);
      const remainingDays = Math.floor(remainingTime / (24 * 60 * 60 * 1000));
      const remainingWeeks = Math.floor(remainingDays / 7);
      const remainingMonths = Math.floor(remainingWeeks / 4.33);

      // ANC Visit Schedule with Optional Visits
      const visits = [
        { visit: 'Visit 1', week: 12 },
        { visit: 'Visit 2', week: 16 },
        { visit: 'Visit *', week: 20 },
        { visit: 'Visit 3', week: 24 },
        { visit: 'Visit 4', week: 28 },
        { visit: 'Visit 5', week: 32 },
        { visit: 'Visit 6', week: 34 },
        { visit: 'Visit 7', week: 36 },
        { visit: 'Visit *', week: 38 },
        { visit: 'Visit 8', week: 40 }
      ];

      let visitRows = '';
      visits.forEach(v => {
        const visitDate = new Date(lmpDate);
        visitDate.setDate(lmpDate.getDate() + v.week * 7);
        visitRows += `
          <tr>
            <td>${v.visit}</td>
            <td>${v.week} weeks</td>
            <td>${visitDate.toISOString().split('T')[0]} (AD)</td>
            <td>${new NepaliDate(visitDate).format('YYYY-MM-DD')} (BS)</td>
          </tr>
        `;
      });

      document.getElementById('visit-schedule').innerHTML = `
        <p><strong>Weeks Completed:</strong> ${weeksCompleted} weeks</p>
        <p><strong>Months Completed:</strong> ${monthsCompleted} months</p>
        <p><strong>Days Completed:</strong> ${daysCompleted} days</p>
        <p><strong>Estimated Date of Delivery:</strong> <strong>${edd.toISOString().split('T')[0]} (AD)</strong> / <strong>${new NepaliDate(edd).format('YYYY-MM-DD')} (BS)</strong></p>
        <table>
          <thead>
            <tr>
              <th>Visit</th>
              <th>Weeks</th>
              <th>Date (AD)</th>
              <th>Date (BS)</th>
            </tr>
          </thead>
          <tbody>
            ${visitRows}
          </tbody>
        </table>
      `;

      document.getElementById('gestational-info').innerHTML = `
        <h4>Original Gestational Age:</h4>
        <p>${monthsCompleted} months, ${Math.floor(weeksCompleted % 4.33)} weeks, ${daysCompleted} days</p>
        <h4>Original Remaining Time:</h4>
        <p>${remainingMonths} months, ${remainingWeeks % 4} weeks, ${remainingDays % 7} days</p>
      `;
    }

    // Function to set the custom date to today's date
    function setToToday() {
      todayDate = new Date();
      document.getElementById('custom-date').value = todayDate.toISOString().split('T')[0];
      calculateCustomGestationalAge();
    }

    // Function to calculate Custom Gestational Age and Remaining Time
    function calculateCustomGestationalAge() {
      const customDateInput = document.getElementById('custom-date').value;
      if (customDateInput) {
        todayDate = new Date(customDateInput);
      }

      const adDateInput = document.getElementById('lmp-date-ad').value;
      if (!adDateInput) {
        alert('Please enter a valid LMP date in AD format.');
        return;
      }
      const lmpDate = new Date(adDateInput);

      const weeksCompleted = Math.floor((todayDate - lmpDate) / (7 * 24 * 60 * 60 * 1000));
      const monthsCompleted = Math.floor(weeksCompleted / 4.33);
      const daysCompleted = Math.floor((todayDate - lmpDate) / (24 * 60 * 60 * 1000));

      const edd = new Date(lmpDate);
      edd.setDate(lmpDate.getDate() + 280);

      const remainingTime = new Date(edd - todayDate);
      const remainingDays = Math.floor(remainingTime / (24 * 60 * 60 * 1000));
      const remainingWeeks = Math.floor(remainingDays / 7);
      const remainingMonths = Math.floor(remainingWeeks / 4.33);

      document.getElementById('custom-gestational-info').innerHTML = `
        <h4>Custom Gestational Age:</h4>
        <p>${monthsCompleted} months, ${Math.floor(weeksCompleted % 4.33)} weeks, ${daysCompleted} days</p>
      `;
      document.getElementById('custom-remaining-time').innerHTML = `
        <h4>Custom Remaining Time:</h4>
        <p>${remainingMonths} months, ${remainingWeeks % 4} weeks, ${remainingDays % 7} days</p>
      `;
    }
  </script>
</body>

</html>
